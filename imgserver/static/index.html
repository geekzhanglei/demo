<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>图片上传</title>
</head>

<body>
    <!-- 方法一：form表单：原生 -->
    <h1>方法一：form表单：原生</h1>
    <form action="http://127.0.0.1:3000/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" /> <input type="submit" value="ok" />
    </form>

     <!-- 方法二：form表单：iframe -->
     <h1>方法二：form表单：iframe</h1>
     <form action="http://127.0.0.1:3000/upload" method="post" enctype="multipart/form-data" target="uploadIframe">
         <input type="file" name="file" /> <input type='submit' value="ok"/>
     </form>
     <iframe frameborder="0" name="uploadIframe" onLoad="iframeLoad(this)"></iframe>

    <!-- 方法三： ajax的formData上传-->
    <h2>方法三：ajax的formData上传</h2>
    <input accept="image/*" name="img" id="upload_file" type="file" onchange="change()">

    <!-- 图片预览 -->
    <h2>图片预览</h2>
    <input type="file" id="preview">
    <img alt="图片预览位置" id='previewImg'>

    <!-- 图片压缩示例 -->
    <h2>图片压缩示例</h2>
    <input type="file" id='compress' onchange='mycompress()'>
    <canvas id="canvas"></canvas>
    <img src="./1.png" alt="nono" id="testImg">

</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    // 方法二：
    function iframeLoad(iframe) {
        var doc = iframe.contentWindow.document; 
        doc.body.innerHTML;
    }
    // 方法三：
    function change() {
        var file = document.getElementById("upload_file").files[0];
        var formdata = new FormData(); // 创建form对象
        formdata.append('file', file, file.name); // 通过append向form对象添加数据,可以通过append继续添加数据，第一个type参数决定后端字段为ctx.request.files[type]
        //或formdata.append('img',file);
        let config = {
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        }; //添加请求头
        axios.post('http://127.0.0.1:3000/upload', formdata, config).then(response => { //这里的/xapi/upimage为接口
            console.log(response.data);
        });
    }
    // 图片预览方法一
    document.getElementById('preview').onchange = function(event) {
        var ele =  document.getElementById('preview').files[0];
        var img = document.getElementById('previewImg');
        img.src=window.URL.createObjectURL(ele);
    }
    // 图片预览方法二
    // document.getElementById('preview').onchange = function(event) {
    //     var ele =  document.getElementById('preview').files[0];
    //     var img = document.getElementById('previewImg');
    //     var fr = new FileReader();
    //     fr.onload = function(e) {
    //         img.src=e.target.result;
    //     }
    //     fr.readAsDataURL(ele);
    // }
    
    // 图片压缩处理实例
    function mycompress(){
        // var img = document.getElementById("compress").files[0];
        var img = document.getElementById('testImg');
        console.log(img)
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img,0,0,200,200);
        
    }
</script>

</html>
